!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.FractionalDelay=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var FractionalDelay = function FractionalDelay(sampleRate, optMaxDelayTime) {
  this.delayTime = 0;
  this.maxDelayTime = 1;
  this.posRead = 0;
  this.posWrite = 0;
  this.fracXi1 = 0;
  this.fracYi1 = 0;
  this.intDelay = 0;
  this.fracDelay = 0;
  this.buffer = undefined;
  this.bufferSize = undefined;
  this.a1 = undefined;
  this.sampleRate = sampleRate;
  this.maxDelayTime = optMaxDelayTime || this.maxDelayTime;
  this.bufferSize = this.maxDelayTime * this.sampleRate;
  if (this.bufferSize % 1 !== 0) {
    this.bufferSize = parseInt(this.bufferSize) + 1;
  }
  this.buffer = new Float32Array(this.bufferSize);
  return this;
};
($traceurRuntime.createClass)(FractionalDelay, {
  setDelay: function(delayTime) {
    if (delayTime < this.maxDelayTime) {
      this.delayTime = delayTime;
      var samplesDelay = delayTime * this.sampleRate;
      this.intDelay = parseInt(samplesDelay);
      this.fracDelay = samplesDelay - this.intDelay;
      this.resample();
      if (this.fracDelay !== 0) {
        this.updateThiranCoefficient();
      }
    } else {
      console.log("throw error...how?");
    }
  },
  getDelay: function() {
    return this.delayTime;
  },
  process: function(inputBuffer) {
    var outputBuffer = new Float32Array(inputBuffer.length);
    for (var i = 0; i < inputBuffer.length; i = i + 1) {
      this.buffer[this.posWrite] = inputBuffer[i];
      outputBuffer[i] = this.buffer[this.posRead];
      this.updatePointers();
    }
    if (this.fracDelay === 0) {
      return outputBuffer;
    } else {
      outputBuffer = new Float32Array(this.fractionalThiranProcess(outputBuffer));
      return outputBuffer;
    }
  },
  updatePointers: function() {
    if (this.posWrite === (this.buffer.length - 1)) {
      this.posWrite = 0;
    } else {
      this.posWrite = this.posWrite + 1;
    }
    if (this.posRead === (this.buffer.length - 1)) {
      this.posRead = 0;
    } else {
      this.posRead = this.posRead + 1;
    }
  },
  updateThiranCoefficient: function() {
    this.a1 = (1 - this.fracDelay) / (1 + this.fracDelay);
  },
  resample: function() {
    if (this.posWrite - this.intDelay < 0) {
      var pos = this.intDelay - this.posWrite;
      this.posRead = this.buffer.length - pos;
    } else {
      this.posRead = this.posWrite - this.intDelay;
    }
  },
  fractionalThiranProcess: function(inputBuffer) {
    var outputBuffer = new Float32Array(inputBuffer.length);
    var x,
        y;
    var xi1 = this.fracXi1;
    var yi1 = this.fracYi1;
    for (var i = 0; i < inputBuffer.length; i = i + 1) {
      x = inputBuffer[i];
      y = this.a1 * x + xi1 - this.a1 * yi1;
      xi1 = x;
      yi1 = y;
      outputBuffer[i] = y;
    }
    this.fracXi1 = xi1;
    this.fracYi1 = yi1;
    return outputBuffer;
  }
}, {});
;
module.exports = FractionalDelay;


//# sourceURL=/Users/goldszmidt/sam/pro/dev/fractional-delay/fractional-delay.es6.js
},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9nb2xkc3ptaWR0L3NhbS9wcm8vZGV2L2ZyYWN0aW9uYWwtZGVsYXkvZnJhY3Rpb25hbC1kZWxheS5lczYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNTQTtBQVRBLEFBQUksRUFBQSxrQkFTSixTQUFNLGdCQUFjLENBU0osVUFBUyxDQUFHLENBQUEsZUFBYyxDQUFHO0FBRXJDLEtBQUcsVUFBVSxFQUFJLEVBQUEsQ0FBQTtBQUNqQixLQUFHLGFBQWEsRUFBSSxFQUFBLENBQUE7QUFDcEIsS0FBRyxRQUFRLEVBQUksRUFBQSxDQUFBO0FBQ2YsS0FBRyxTQUFTLEVBQUksRUFBQSxDQUFBO0FBQ2hCLEtBQUcsUUFBUSxFQUFJLEVBQUEsQ0FBQTtBQUNmLEtBQUcsUUFBUSxFQUFJLEVBQUEsQ0FBQTtBQUNmLEtBQUcsU0FBUyxFQUFJLEVBQUEsQ0FBQTtBQUNoQixLQUFHLFVBQVUsRUFBSSxFQUFBLENBQUE7QUFHakIsS0FBRyxPQUFPLEVBQUksVUFBUSxDQUFDO0FBQ3ZCLEtBQUcsV0FBVyxFQUFJLFVBQVEsQ0FBQztBQUMzQixLQUFHLEdBQUcsRUFBSSxVQUFRLENBQUM7QUFHbkIsS0FBRyxXQUFXLEVBQUksV0FBUyxDQUFDO0FBQzVCLEtBQUcsYUFBYSxFQUFJLENBQUEsZUFBYyxHQUFLLENBQUEsSUFBRyxhQUFhLENBQUM7QUFFeEQsS0FBRyxXQUFXLEVBQUksQ0FBQSxJQUFHLGFBQWEsRUFBSSxDQUFBLElBQUcsV0FBVyxDQUFDO0FBRXJELEtBQUksSUFBRyxXQUFXLEVBQUksRUFBQSxDQUFBLEdBQU0sRUFBQSxDQUFHO0FBQzNCLE9BQUcsV0FBVyxFQUFJLENBQUEsUUFBTyxBQUFDLENBQUMsSUFBRyxXQUFXLENBQUMsQ0FBQSxDQUFJLEVBQUEsQ0FB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LElBQUUsQ0FBQztBQUNsQixPQUFHLFFBQVEsRUFBSSxJQUFFLENBQUM7QUFFbEIsU0FBTyxhQUFXLENBQUM7RUFDdkI7QUFBQSxLQWhNaUY7QUFrTXBGO0FBR0QsS0FBSyxRQUFRLEVBQUksZ0JBQWMsQ0FBQztBQUNoQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKipcbiAqIEBmaWxlb3ZlcnZpZXcgRnJhY3Rpb25hbCBkZWxheSBsaWJyYXJ5XG4gKiBAYXV0aG9yIEFybmF1IEp1bGnDoCA8QXJuYXUuSnVsaWFAZ21haWwuY29tPlxuICogQHZlcnNpb24gMC4xLjBcbiAqL1xuLyoqXG4gKiBAY2xhc3MgRnJhY3Rpb25hbERlbGF5XG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEZyYWN0aW9uYWxEZWxheSB7XG5cbiAgICAvKipcbiAgICAgKiBNYW5kYXRvcnkgaW5pdGlhbGl6YXRpb24gbWV0aG9kLlxuICAgICAqIEBwdWJsaWNcbiAgICAgKiBAcGFyYW0gdW5pdHM6SHogc2FtcGxlUmF0ZSBTYW1wbGUgUmF0ZSB0aGUgYXBwYXJhdHVzIG9wZXJhdGVzIG9uLlxuICAgICAqIEBwYXJhbSB0eXBlOkZsb2F0IHVuaXRzOnMgbWluOjAuMCBkZWZhdWx0OjEgb3B0TWF4RGVsYXlUaW1lIFRoZSBtYXhpbXVtIGRlbGF5IHRpbWUuXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHNhbXBsZVJhdGUsIG9wdE1heERlbGF5VGltZSkge1xuICAgICAgICAvLyBQcm9wZXJ0aWVzIHdpdGggZGVmYXVsdCB2YWx1ZXNcbiAgICAgICAgdGhpcy5kZWxheVRpbWUgPSAwXG4gICAgICAgIHRoaXMubWF4RGVsYXlUaW1lID0gMVxuICAgICAgICB0aGlzLnBvc1JlYWQgPSAwXG4gICAgICAgIHRoaXMucG9zV3JpdGUgPSAwXG4gICAgICAgIHRoaXMuZnJhY1hpMSA9IDBcbiAgICAgICAgdGhpcy5mcmFjWWkxID0gMFxuICAgICAgICB0aGlzLmludERlbGF5ID0gMFxuICAgICAgICB0aGlzLmZyYWNEZWxheSA9IDBcblxuICAgICAgICAvLyBPdGhlciBwcm9wZXJ0aWVzXG4gICAgICAgIHRoaXMuYnVmZmVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJ1ZmZlclNpemUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYTEgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgLy8gU2F2ZSBzYW1wbGUgcmF0ZVxuICAgICAgICB0aGlzLnNhbXBsZVJhdGUgPSBzYW1wbGVSYXRlO1xuICAgICAgICB0aGlzLm1heERlbGF5VGltZSA9IG9wdE1heERlbGF5VGltZSB8fCB0aGlzLm1heERlbGF5VGltZTtcblxuICAgICAgICB0aGlzLmJ1ZmZlclNpemUgPSB0aGlzLm1heERlbGF5VGltZSAqIHRoaXMuc2FtcGxlUmF0ZTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGJ1ZmZlclNpemUgaXMgbm90IGFuIGludGVnZXJcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyU2l6ZSAlIDEgIT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyU2l6ZSA9IHBhcnNlSW50KHRoaXMuYnVmZmVyU2l6ZSkgKyAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgaW50ZXJuYWwgYnVmZmVyXG4gICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLmJ1ZmZlclNpemUpO1xuXG4gICAgICAgIHJldHVybiB0aGlzOyAvLyBmb3IgY2hhaW5hYmlsaXR5XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0IGRlbGF5IHZhbHVlXG4gICAgICogQHBhcmFtIGRlbGF5VGltZSBEZWxheSB0aW1lXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHNldERlbGF5KGRlbGF5VGltZSkge1xuICAgICAgICBpZiAoZGVsYXlUaW1lIDwgdGhpcy5tYXhEZWxheVRpbWUpIHtcbiAgICAgICAgICAgIC8vIFNhdmUgZGVsYXkgdmFsdWVcbiAgICAgICAgICAgIHRoaXMuZGVsYXlUaW1lID0gZGVsYXlUaW1lO1xuICAgICAgICAgICAgLy8gVHJhbnNmb3JtIHRpbWUgaW4gc2FtcGxlc1xuICAgICAgICAgICAgdmFyIHNhbXBsZXNEZWxheSA9IGRlbGF5VGltZSAqIHRoaXMuc2FtcGxlUmF0ZTtcbiAgICAgICAgICAgIC8vIEdldCB0aGUgaW50ZWdlciBwYXJ0IG9mIHNhbXBsZXNEZWxheVxuICAgICAgICAgICAgdGhpcy5pbnREZWxheSA9IHBhcnNlSW50KHNhbXBsZXNEZWxheSk7XG4gICAgICAgICAgICAvLyBHZXQgdGhlIGZyYWN0aW9uYWwgcGFydCBvZiBzYW1wbGVzRGVsYXlcbiAgICAgICAgICAgIHRoaXMuZnJhY0RlbGF5ID0gc2FtcGxlc0RlbGF5IC0gdGhpcy5pbnREZWxheTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdmFsdWUgb2YgdGhlIHBvaW50ZXJcbiAgICAgICAgICAgIHRoaXMucmVzYW1wbGUoKTtcbiAgICAgICAgICAgIC8vIElmIHRoZSBkZWxheSBoYXMgZnJhY3Rpb25hbCBwYXJ0LCB1cGRhdGUgdGhlIFRoaXJhbiBDb2VmZmljaWVudHNcbiAgICAgICAgICAgIGlmICh0aGlzLmZyYWNEZWxheSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVGhpcmFuQ29lZmZpY2llbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGhyb3cgZXJyb3IuLi5ob3c/XCIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgZGVsYXkgdmFsdWVcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgZ2V0RGVsYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGF5VGltZTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFByb2Nlc3MgbWV0aG9kLCB3aGVyZSB0aGUgb3V0cHV0IGlzIGNhbGN1bGF0ZWQuXG4gICAgICogQHBhcmFtIGlucHV0QnVmZmVyIElucHV0IEFycmF5XG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHByb2Nlc3MoaW5wdXRCdWZmZXIpIHtcbiAgICAgICAgLy8gQ3JlYXRlcyB0aGUgb3V0cHV0QnVmZmVyLCB3aXRoIHRoZSBzYW1lIGxlbmd0aCBvZiB0aGUgaW5wdXRcbiAgICAgICAgdmFyIG91dHB1dEJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoaW5wdXRCdWZmZXIubGVuZ3RoKTtcblxuICAgICAgICAvLyBJbnRlZ2VyIGRlbGF5IHByb2Nlc3Mgc2VjdGlvblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0QnVmZmVyLmxlbmd0aDsgaSA9IGkgKyAxKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBpbnB1dCB2YWx1ZSBpbiB0aGUgYnVmZmVyXG4gICAgICAgICAgICB0aGlzLmJ1ZmZlclt0aGlzLnBvc1dyaXRlXSA9IGlucHV0QnVmZmVyW2ldO1xuICAgICAgICAgICAgLy8gV3JpdGUgdGhlIG91dHB1dEJ1ZmZlciB3aXRoIHRoZSBbaW5wdXRWYWx1ZSAtIGRlbGF5XSBzYW1wbGVcbiAgICAgICAgICAgIG91dHB1dEJ1ZmZlcltpXSA9IHRoaXMuYnVmZmVyW3RoaXMucG9zUmVhZF07XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHZhbHVlIG9mIHBvc1JlYWQgYW5kIHBvc1dyaXRlIHBvaW50ZXJzXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvaW50ZXJzKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm8gZnJhY3Rpb25hbCBkZWxheVxuICAgICAgICBpZiAodGhpcy5mcmFjRGVsYXkgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXRCdWZmZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUaGUgZnJhY3Rpb25hbCBkZWxheSBwcm9jZXNzIHNlY3Rpb25cbiAgICAgICAgICAgIG91dHB1dEJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5mcmFjdGlvbmFsVGhpcmFuUHJvY2VzcyhvdXRwdXRCdWZmZXIpKTtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXRCdWZmZXI7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgdmFsdWUgb2YgcG9zUmVhZCBhbmQgcG9zV3JpdGUgcG9pbnRlcnMgaW5zaWRlIHRoZSBjaXJjdWxhciBidWZmZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHVwZGF0ZVBvaW50ZXJzKCkge1xuICAgICAgICAvLyBJdCdzIGEgY2lyY3VsYXIgYnVmZmVyLCBzbywgd2hlbiBpdCBpcyBhdCB0aGUgbGFzdCBwb3NpdGlvbiwgdGhlIHBvaW50ZXIgcmV0dXJuIHRvIHRoZSBmaXJzdCBwb3NpdGlvblxuXG4gICAgICAgIC8vIFVwZGF0ZSBwb3NXcml0ZSBwb2ludGVyXG4gICAgICAgIGlmICh0aGlzLnBvc1dyaXRlID09PSAodGhpcy5idWZmZXIubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgIHRoaXMucG9zV3JpdGUgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wb3NXcml0ZSA9IHRoaXMucG9zV3JpdGUgKyAxO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHBvc1JlYWQgcG9pbnRlclxuICAgICAgICBpZiAodGhpcy5wb3NSZWFkID09PSAodGhpcy5idWZmZXIubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgIHRoaXMucG9zUmVhZCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLnBvc1JlYWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgVGhpcmFuIGNvZWZmaWNpZW50ICgxc3Qgb3JkZXIgVGhpcmFuKVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdXBkYXRlVGhpcmFuQ29lZmZpY2llbnQoKSB7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgY29lZmZpY2llbnQ6ICgxLUQpLygxK0QpIHdoZXJlIEQgaXMgZnJhY3Rpb25hbCBkZWxheVxuICAgICAgICB0aGlzLmExID0gKDEgLSB0aGlzLmZyYWNEZWxheSkgLyAoMSArIHRoaXMuZnJhY0RlbGF5KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgcG9pbnRlciBwb3NSZWFkIHZhbHVlIHdoZW4gdGhlIGRlbGF5IHZhbHVlIGlzIGNoYW5nZWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHJlc2FtcGxlKCkge1xuICAgICAgICBpZiAodGhpcy5wb3NXcml0ZSAtIHRoaXMuaW50RGVsYXkgPCAwKSB7XG4gICAgICAgICAgICB2YXIgcG9zID0gdGhpcy5pbnREZWxheSAtIHRoaXMucG9zV3JpdGU7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLmJ1ZmZlci5sZW5ndGggLSBwb3M7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLnBvc1dyaXRlIC0gdGhpcy5pbnREZWxheTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRnJhY3Rpb25hbCBwcm9jZXNzIG1ldGhvZC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBpbnB1dEJ1ZmZlciBJbnB1dCBBcnJheVxuICAgICAqL1xuICAgIGZyYWN0aW9uYWxUaGlyYW5Qcm9jZXNzKGlucHV0QnVmZmVyKSB7XG4gICAgICAgIHZhciBvdXRwdXRCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KGlucHV0QnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgICAgdmFyIHgsIHk7XG4gICAgICAgIHZhciB4aTEgPSB0aGlzLmZyYWNYaTE7XG4gICAgICAgIHZhciB5aTEgPSB0aGlzLmZyYWNZaTE7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dEJ1ZmZlci5sZW5ndGg7IGkgPSBpICsgMSkge1xuICAgICAgICAgICAgLy8gQ3VycmVudCBpbnB1dCBzYW1wbGVcbiAgICAgICAgICAgIHggPSBpbnB1dEJ1ZmZlcltpXTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBvdXRwdXRcbiAgICAgICAgICAgIHkgPSB0aGlzLmExICogeCArIHhpMSAtIHRoaXMuYTEgKiB5aTE7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbWVtb3JpZXNcbiAgICAgICAgICAgIHhpMSA9IHg7XG4gICAgICAgICAgICB5aTEgPSB5O1xuICAgICAgICAgICAgLy8gU2F2ZSB0aGUgb3V0cHV0QnVmZmVyXG4gICAgICAgICAgICBvdXRwdXRCdWZmZXJbaV0gPSB5O1xuXG4gICAgICAgIH1cbiAgICAgICAgLy8gU2F2ZSBtZW1vcmllc1xuICAgICAgICB0aGlzLmZyYWNYaTEgPSB4aTE7XG4gICAgICAgIHRoaXMuZnJhY1lpMSA9IHlpMTtcblxuICAgICAgICByZXR1cm4gb3V0cHV0QnVmZmVyO1xuICAgIH1cblxufTsgLy8gRW5kIG9mIG9iamVjdCBkZWZpbml0aW9uLlxuXG5cbm1vZHVsZS5leHBvcnRzID0gRnJhY3Rpb25hbERlbGF5O1xuIl19
