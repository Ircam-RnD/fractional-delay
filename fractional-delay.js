!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.FractionalDelay=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var FractionalDelay = function FractionalDelay(sampleRate, optMaxDelayTime) {
  this.delayTime = 0;
  this.posRead = 0;
  this.posWrite = 0;
  this.fracXi1 = 0;
  this.fracYi1 = 0;
  this.intDelay = 0;
  this.fracDelay = 0;
  this.a1 = undefined;
  this.sampleRate = sampleRate;
  this.maxDelayTime = optMaxDelayTime || 1;
  this.bufferSize = this.maxDelayTime * this.sampleRate;
  if (this.bufferSize % 1 !== 0) {
    this.bufferSize = parseInt(this.bufferSize) + 1;
  }
  this.buffer = new Float32Array(this.bufferSize);
};
($traceurRuntime.createClass)(FractionalDelay, {
  setDelay: function(delayTime) {
    if (delayTime < this.maxDelayTime) {
      this.delayTime = delayTime;
      var samplesDelay = delayTime * this.sampleRate;
      this.intDelay = parseInt(samplesDelay);
      this.fracDelay = samplesDelay - this.intDelay;
      this.resample();
      if (this.fracDelay !== 0) {
        this.updateThiranCoefficient();
      }
    } else {
      throw new Error("delayTime > maxDelayTime");
    }
  },
  getDelay: function() {
    return this.delayTime;
  },
  process: function(inputBuffer) {
    var outputBuffer = new Float32Array(inputBuffer.length);
    for (var i = 0; i < inputBuffer.length; i = i + 1) {
      this.buffer[this.posWrite] = inputBuffer[i];
      outputBuffer[i] = this.buffer[this.posRead];
      this.updatePointers();
    }
    if (this.fracDelay === 0) {
      return outputBuffer;
    } else {
      outputBuffer = new Float32Array(this.fractionalThiranProcess(outputBuffer));
      return outputBuffer;
    }
  },
  updatePointers: function() {
    if (this.posWrite === (this.buffer.length - 1)) {
      this.posWrite = 0;
    } else {
      this.posWrite = this.posWrite + 1;
    }
    if (this.posRead === (this.buffer.length - 1)) {
      this.posRead = 0;
    } else {
      this.posRead = this.posRead + 1;
    }
  },
  updateThiranCoefficient: function() {
    this.a1 = (1 - this.fracDelay) / (1 + this.fracDelay);
  },
  resample: function() {
    if (this.posWrite - this.intDelay < 0) {
      var pos = this.intDelay - this.posWrite;
      this.posRead = this.buffer.length - pos;
    } else {
      this.posRead = this.posWrite - this.intDelay;
    }
  },
  fractionalThiranProcess: function(inputBuffer) {
    var outputBuffer = new Float32Array(inputBuffer.length);
    var x,
        y;
    var xi1 = this.fracXi1;
    var yi1 = this.fracYi1;
    for (var i = 0; i < inputBuffer.length; i = i + 1) {
      x = inputBuffer[i];
      y = this.a1 * x + xi1 - this.a1 * yi1;
      xi1 = x;
      yi1 = y;
      outputBuffer[i] = y;
    }
    this.fracXi1 = xi1;
    this.fracYi1 = yi1;
    return outputBuffer;
  }
}, {});
;
module.exports = FractionalDelay;


//# sourceURL=/Users/goldszmidt/sam/pro/dev/fractional-delay/fractional-delay.es6.js
},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9nb2xkc3ptaWR0L3NhbS9wcm8vZGV2L2ZyYWN0aW9uYWwtZGVsYXkvZnJhY3Rpb25hbC1kZWxheS5lczYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNTQTtBQVRBLEFBQUksRUFBQSxrQkFTSixTQUFNLGdCQUFjLENBU0osVUFBUyxDQUFHLENBQUEsZUFBYyxDQUFHO0FBRXJDLEtBQUcsVUFBVSxFQUFJLEVBQUEsQ0FBQztBQUNsQixLQUFHLFFBQVEsRUFBSSxFQUFBLENBQUM7QUFDaEIsS0FBRyxTQUFTLEVBQUksRUFBQSxDQUFDO0FBQ2pCLEtBQUcsUUFBUSxFQUFJLEVBQUEsQ0FBQztBQUNoQixLQUFHLFFBQVEsRUFBSSxFQUFBLENBQUM7QUFDaEIsS0FBRyxTQUFTLEVBQUksRUFBQSxDQUFDO0FBQ2pCLEtBQUcsVUFBVSxFQUFJLEVBQUEsQ0FBQztBQUdsQixLQUFHLEdBQUcsRUFBSSxVQUFRLENBQUM7QUFHbkIsS0FBRyxXQUFXLEVBQUksV0FBUyxDQUFDO0FBQzVCLEtBQUcsYUFBYSxFQUFJLENBQUEsZUFBYyxHQUFLLEVBQUEsQ0FBQztBQUV4QyxLQUFHLFdBQVcsRUFBSSxDQUFBLElBQUcsYUFBYSxFQUFJLENBQUEsSUFBRyxXQUFXLENBQUM7QUFFckQsS0FBSSxJQUFHLFdBQVcsRUFBSSxFQUFBLENBQUEsR0FBTSxFQUFBLENBQUc7QUFDM0IsT0FBRyxXQUFXLEVBQUksQ0FBQSxRQUFPLEFBQUMsQ0FBQyxJQUFHLFdBQVcsQ0FBQyxDQUFBLENBQUksRUFBQSxDQUFDO0VBQ25EO0FBQUEsQUFFQSxLQUFHLE9BQU8sRUFBSSxJQUFJLGFBQVcsQUFBQyxDQUFDLElBQUcsV0FBVyxDQUFDLENBQUM7QUFDbkQsQUExQ29DLENBQUE7QUFBeEMsQUFB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QUFDO0FBQ2hDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKlxuICogQGZpbGVvdmVydmlldyBGcmFjdGlvbmFsIGRlbGF5IGxpYnJhcnlcbiAqIEBhdXRob3IgQXJuYXUgSnVsacOgIDxBcm5hdS5KdWxpYUBnbWFpbC5jb20+XG4gKiBAdmVyc2lvbiAwLjEuMFxuICovXG4vKipcbiAqIEBjbGFzcyBGcmFjdGlvbmFsRGVsYXlcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgRnJhY3Rpb25hbERlbGF5IHtcblxuICAgIC8qKlxuICAgICAqIE1hbmRhdG9yeSBpbml0aWFsaXphdGlvbiBtZXRob2QuXG4gICAgICogQHB1YmxpY1xuICAgICAqIEBwYXJhbSB1bml0czpIeiBzYW1wbGVSYXRlIFNhbXBsZSBSYXRlIHRoZSBhcHBhcmF0dXMgb3BlcmF0ZXMgb24uXG4gICAgICogQHBhcmFtIHR5cGU6RmxvYXQgdW5pdHM6cyBtaW46MC4wIGRlZmF1bHQ6MSBvcHRNYXhEZWxheVRpbWUgVGhlIG1heGltdW0gZGVsYXkgdGltZS5cbiAgICAgKiBAY2hhaW5hYmxlXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc2FtcGxlUmF0ZSwgb3B0TWF4RGVsYXlUaW1lKSB7XG4gICAgICAgIC8vIFByb3BlcnRpZXMgd2l0aCBkZWZhdWx0IHZhbHVlc1xuICAgICAgICB0aGlzLmRlbGF5VGltZSA9IDA7XG4gICAgICAgIHRoaXMucG9zUmVhZCA9IDA7XG4gICAgICAgIHRoaXMucG9zV3JpdGUgPSAwO1xuICAgICAgICB0aGlzLmZyYWNYaTEgPSAwO1xuICAgICAgICB0aGlzLmZyYWNZaTEgPSAwO1xuICAgICAgICB0aGlzLmludERlbGF5ID0gMDtcbiAgICAgICAgdGhpcy5mcmFjRGVsYXkgPSAwO1xuXG4gICAgICAgIC8vIE90aGVyIHByb3BlcnRpZXNcbiAgICAgICAgdGhpcy5hMSA9IHVuZGVmaW5lZDtcblxuICAgICAgICAvLyBTYXZlIHNhbXBsZSByYXRlXG4gICAgICAgIHRoaXMuc2FtcGxlUmF0ZSA9IHNhbXBsZVJhdGU7XG4gICAgICAgIHRoaXMubWF4RGVsYXlUaW1lID0gb3B0TWF4RGVsYXlUaW1lIHx8IDE7XG5cbiAgICAgICAgdGhpcy5idWZmZXJTaXplID0gdGhpcy5tYXhEZWxheVRpbWUgKiB0aGlzLnNhbXBsZVJhdGU7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBidWZmZXJTaXplIGlzIG5vdCBhbiBpbnRlZ2VyXG4gICAgICAgIGlmICh0aGlzLmJ1ZmZlclNpemUgJSAxICE9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlclNpemUgPSBwYXJzZUludCh0aGlzLmJ1ZmZlclNpemUpICsgMTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDcmVhdGUgdGhlIGludGVybmFsIGJ1ZmZlclxuICAgICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5idWZmZXJTaXplKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgZGVsYXkgdmFsdWVcbiAgICAgKiBAcGFyYW0gZGVsYXlUaW1lIERlbGF5IHRpbWVcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgc2V0RGVsYXkoZGVsYXlUaW1lKSB7XG4gICAgICAgIGlmIChkZWxheVRpbWUgPCB0aGlzLm1heERlbGF5VGltZSkge1xuICAgICAgICAgICAgLy8gU2F2ZSBkZWxheSB2YWx1ZVxuICAgICAgICAgICAgdGhpcy5kZWxheVRpbWUgPSBkZWxheVRpbWU7XG4gICAgICAgICAgICAvLyBUcmFuc2Zvcm0gdGltZSBpbiBzYW1wbGVzXG4gICAgICAgICAgICB2YXIgc2FtcGxlc0RlbGF5ID0gZGVsYXlUaW1lICogdGhpcy5zYW1wbGVSYXRlO1xuICAgICAgICAgICAgLy8gR2V0IHRoZSBpbnRlZ2VyIHBhcnQgb2Ygc2FtcGxlc0RlbGF5XG4gICAgICAgICAgICB0aGlzLmludERlbGF5ID0gcGFyc2VJbnQoc2FtcGxlc0RlbGF5KTtcbiAgICAgICAgICAgIC8vIEdldCB0aGUgZnJhY3Rpb25hbCBwYXJ0IG9mIHNhbXBsZXNEZWxheVxuICAgICAgICAgICAgdGhpcy5mcmFjRGVsYXkgPSBzYW1wbGVzRGVsYXkgLSB0aGlzLmludERlbGF5O1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB2YWx1ZSBvZiB0aGUgcG9pbnRlclxuICAgICAgICAgICAgdGhpcy5yZXNhbXBsZSgpO1xuICAgICAgICAgICAgLy8gSWYgdGhlIGRlbGF5IGhhcyBmcmFjdGlvbmFsIHBhcnQsIHVwZGF0ZSB0aGUgVGhpcmFuIENvZWZmaWNpZW50c1xuICAgICAgICAgICAgaWYgKHRoaXMuZnJhY0RlbGF5ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVUaGlyYW5Db2VmZmljaWVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZGVsYXlUaW1lID4gbWF4RGVsYXlUaW1lXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgZGVsYXkgdmFsdWVcbiAgICAgKiBAcHVibGljXG4gICAgICovXG4gICAgZ2V0RGVsYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRlbGF5VGltZTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFByb2Nlc3MgbWV0aG9kLCB3aGVyZSB0aGUgb3V0cHV0IGlzIGNhbGN1bGF0ZWQuXG4gICAgICogQHBhcmFtIGlucHV0QnVmZmVyIElucHV0IEFycmF5XG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHByb2Nlc3MoaW5wdXRCdWZmZXIpIHtcbiAgICAgICAgLy8gQ3JlYXRlcyB0aGUgb3V0cHV0QnVmZmVyLCB3aXRoIHRoZSBzYW1lIGxlbmd0aCBvZiB0aGUgaW5wdXRcbiAgICAgICAgdmFyIG91dHB1dEJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoaW5wdXRCdWZmZXIubGVuZ3RoKTtcblxuICAgICAgICAvLyBJbnRlZ2VyIGRlbGF5IHByb2Nlc3Mgc2VjdGlvblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0QnVmZmVyLmxlbmd0aDsgaSA9IGkgKyAxKSB7XG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBpbnB1dCB2YWx1ZSBpbiB0aGUgYnVmZmVyXG4gICAgICAgICAgICB0aGlzLmJ1ZmZlclt0aGlzLnBvc1dyaXRlXSA9IGlucHV0QnVmZmVyW2ldO1xuICAgICAgICAgICAgLy8gV3JpdGUgdGhlIG91dHB1dEJ1ZmZlciB3aXRoIHRoZSBbaW5wdXRWYWx1ZSAtIGRlbGF5XSBzYW1wbGVcbiAgICAgICAgICAgIG91dHB1dEJ1ZmZlcltpXSA9IHRoaXMuYnVmZmVyW3RoaXMucG9zUmVhZF07XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHZhbHVlIG9mIHBvc1JlYWQgYW5kIHBvc1dyaXRlIHBvaW50ZXJzXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBvaW50ZXJzKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm8gZnJhY3Rpb25hbCBkZWxheVxuICAgICAgICBpZiAodGhpcy5mcmFjRGVsYXkgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXRCdWZmZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBUaGUgZnJhY3Rpb25hbCBkZWxheSBwcm9jZXNzIHNlY3Rpb25cbiAgICAgICAgICAgIG91dHB1dEJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkodGhpcy5mcmFjdGlvbmFsVGhpcmFuUHJvY2VzcyhvdXRwdXRCdWZmZXIpKTtcbiAgICAgICAgICAgIHJldHVybiBvdXRwdXRCdWZmZXI7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgdmFsdWUgb2YgcG9zUmVhZCBhbmQgcG9zV3JpdGUgcG9pbnRlcnMgaW5zaWRlIHRoZSBjaXJjdWxhciBidWZmZXJcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHVwZGF0ZVBvaW50ZXJzKCkge1xuICAgICAgICAvLyBJdCdzIGEgY2lyY3VsYXIgYnVmZmVyLCBzbywgd2hlbiBpdCBpcyBhdCB0aGUgbGFzdCBwb3NpdGlvbiwgdGhlIHBvaW50ZXIgcmV0dXJuIHRvIHRoZSBmaXJzdCBwb3NpdGlvblxuXG4gICAgICAgIC8vIFVwZGF0ZSBwb3NXcml0ZSBwb2ludGVyXG4gICAgICAgIGlmICh0aGlzLnBvc1dyaXRlID09PSAodGhpcy5idWZmZXIubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgIHRoaXMucG9zV3JpdGUgPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wb3NXcml0ZSA9IHRoaXMucG9zV3JpdGUgKyAxO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHBvc1JlYWQgcG9pbnRlclxuICAgICAgICBpZiAodGhpcy5wb3NSZWFkID09PSAodGhpcy5idWZmZXIubGVuZ3RoIC0gMSkpIHtcbiAgICAgICAgICAgIHRoaXMucG9zUmVhZCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLnBvc1JlYWQgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgVGhpcmFuIGNvZWZmaWNpZW50ICgxc3Qgb3JkZXIgVGhpcmFuKVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdXBkYXRlVGhpcmFuQ29lZmZpY2llbnQoKSB7XG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgY29lZmZpY2llbnQ6ICgxLUQpLygxK0QpIHdoZXJlIEQgaXMgZnJhY3Rpb25hbCBkZWxheVxuICAgICAgICB0aGlzLmExID0gKDEgLSB0aGlzLmZyYWNEZWxheSkgLyAoMSArIHRoaXMuZnJhY0RlbGF5KTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSB0aGUgcG9pbnRlciBwb3NSZWFkIHZhbHVlIHdoZW4gdGhlIGRlbGF5IHZhbHVlIGlzIGNoYW5nZWRcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHJlc2FtcGxlKCkge1xuICAgICAgICBpZiAodGhpcy5wb3NXcml0ZSAtIHRoaXMuaW50RGVsYXkgPCAwKSB7XG4gICAgICAgICAgICB2YXIgcG9zID0gdGhpcy5pbnREZWxheSAtIHRoaXMucG9zV3JpdGU7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLmJ1ZmZlci5sZW5ndGggLSBwb3M7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBvc1JlYWQgPSB0aGlzLnBvc1dyaXRlIC0gdGhpcy5pbnREZWxheTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRnJhY3Rpb25hbCBwcm9jZXNzIG1ldGhvZC5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSBpbnB1dEJ1ZmZlciBJbnB1dCBBcnJheVxuICAgICAqL1xuICAgIGZyYWN0aW9uYWxUaGlyYW5Qcm9jZXNzKGlucHV0QnVmZmVyKSB7XG4gICAgICAgIHZhciBvdXRwdXRCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KGlucHV0QnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgICAgdmFyIHgsIHk7XG4gICAgICAgIHZhciB4aTEgPSB0aGlzLmZyYWNYaTE7XG4gICAgICAgIHZhciB5aTEgPSB0aGlzLmZyYWNZaTE7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dEJ1ZmZlci5sZW5ndGg7IGkgPSBpICsgMSkge1xuICAgICAgICAgICAgLy8gQ3VycmVudCBpbnB1dCBzYW1wbGVcbiAgICAgICAgICAgIHggPSBpbnB1dEJ1ZmZlcltpXTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBvdXRwdXRcbiAgICAgICAgICAgIHkgPSB0aGlzLmExICogeCArIHhpMSAtIHRoaXMuYTEgKiB5aTE7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbWVtb3JpZXNcbiAgICAgICAgICAgIHhpMSA9IHg7XG4gICAgICAgICAgICB5aTEgPSB5O1xuICAgICAgICAgICAgLy8gU2F2ZSB0aGUgb3V0cHV0QnVmZmVyXG4gICAgICAgICAgICBvdXRwdXRCdWZmZXJbaV0gPSB5O1xuXG4gICAgICAgIH1cbiAgICAgICAgLy8gU2F2ZSBtZW1vcmllc1xuICAgICAgICB0aGlzLmZyYWNYaTEgPSB4aTE7XG4gICAgICAgIHRoaXMuZnJhY1lpMSA9IHlpMTtcblxuICAgICAgICByZXR1cm4gb3V0cHV0QnVmZmVyO1xuICAgIH1cblxufTsgLy8gRW5kIG9mIG9iamVjdCBkZWZpbml0aW9uLlxuXG5cbm1vZHVsZS5leHBvcnRzID0gRnJhY3Rpb25hbERlbGF5O1xuIl19
